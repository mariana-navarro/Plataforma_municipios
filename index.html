<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Levantamiento de Recursos y Capacidades Comunales</title>
    <!-- Agregar Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Agregar CSS para autocompletado -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

    <style>
        /* Tus estilos existentes se mantienen igual */
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #333;
            background-color: #f5f5f5;
            background-image: url('https://live.staticflickr.com/127/333447132_87ae335326_b.jpg'); /* Cambia por tu URL */
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
        }

        .banner {
            width: 100%;
            margin: 0;
            padding: 0;
            position: relative;
            overflow: hidden;
        }

        .banner img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            max-height: 200px; /* Ajusta esta altura máxima según necesites */
        }

        /* Elimina el h1 del banner si solo quieres la imagen */
        .banner h1 {
            display: none; /* Oculta el título si solo quieres la imagen */
        }

        /* Añade margen superior al contenedor principal */
        /* Banner superior del formulario */
        .form-header-banner {
            background-color: #003366; /* Color azul */
            color: white;
            padding: 15px 30px;
            font-size: 23px;
            font-weight: bold;
            margin: -30px -30px 30px -30px; /* Negativos para "salir" del padding del contenedor */
            border-radius: 8px 8px 0 0; /* Solo esquinas superiores redondeadas */
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* Ajuste para el contenedor principal */
        .container {
            max-width: 1000px;
            margin: 30px auto 0;
            background: #dce9f5ab;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            overflow: hidden; /* Importante para que el banner no sobresalga */
        }

        .main-content {
            background-color: rgba(255, 255, 255, 0.9);
            padding: 20px;
            margin: 20px auto;
            max-width: 1000px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .form-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #dce9f5d2;
            overflow: hidden;
        }
        .section-header {
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }
        .section-title {
            margin: 0 0 10px 0;
            color: #003366;
            width: 100%;
        }
        .resource-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
        }
        .resource-counter {
            display: flex;
            gap: 5px;
            flex-wrap: nowrap;
            overflow-x: auto;
            max-width: calc(100% - 80px);
        }

        /* Botón de eliminar (basurero) */
        .delete-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0;
        }

        .delete-button svg {
            width: 14px;
            height: 16px;
            fill: #666;
            transition: all 0.3s ease;
        }

        .delete-button:hover {
            background-color: #e74c3c;
            border-color: #e74c3c;
        }

        .delete-button:hover svg {
            fill: white;
        }

        /* Números de recurso */
        .resource-number {
            min-width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            color: #666;
            transition: all 0.3s ease;
        }

        .resource-number:hover, 
        .resource-number.active {
            background-color: #003366;
            border-color: #003366;
            color: white;
        }

        /* Botón de agregar (+) */
        .add-button {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background-color: transparent;
            border: 1px dashed #666;
            color: #666;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            padding: 0;
            position: relative;
        }

        .add-button::before {
            content: "+";
            position: absolute;
        }

        .add-button:hover {
            border-color: #003366;
            color: #003366;
        }

        /* Contenedores (mantener estos que ya tienes) */
        .resource-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            width: 100%;
            overflow-x: auto;
            padding-bottom: 5px;
        }

        .resource-counter {
            display: flex;
            gap: 5px;
            flex-wrap: nowrap;
            overflow-x: auto;
            max-width: calc(100% - 80px);
        }
        
        .form-group {
            margin-bottom: 20px;
            width: 100%;
            overflow: hidden;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .hint {
            font-size: 0.9em;
            color: #666;
            margin-top: 5px;
        }

        /* Estilos unificados para todos los campos de entrada */
        .form-control {
            width: 100%;
            padding: 12px 15px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background-color: white;
            transition: all 0.3s ease;
            box-sizing: border-box;
            margin-top: 5px;
        }

        .form-control:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }

        .form-control:hover {
            border-color: #3498db;
        }

        /* Estilo específico para selects */
        select.form-control {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            padding-right: 35px;
        }

        /* Estilo para textarea */
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
        }

        /* Contenedor para campos de fecha/hora */
        .datetime-container {
            position: relative;
        }

        .datetime-container::after {
            content: '';
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background-size: contain;
            background-repeat: no-repeat;
            pointer-events: none;
        }

        input[type="date"].form-control,
        input[type="time"].form-control,
        input[type="datetime-local"].form-control {
            padding-right: 35px;
        }

        input[type="date"].form-control + .datetime-container::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z'/%3E%3C/svg%3E");
        }

        input[type="time"].form-control + .datetime-container::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z'/%3E%3Cpath d='M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z'/%3E%3C/svg%3E");
        }

        input[type="datetime-local"].form-control + .datetime-container::after {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z'/%3E%3C/svg%3E");
        }
        
        /* Estilos consistentes para radio buttons */
        .radio-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: #3498db;
        }

        .radio-option input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .radio-option .custom-radio {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 20px;
            min-width: 20px;
            margin-right: 12px;
            border: 2px solid #3498db;
            border-radius: 50%;
            background-color: white;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .radio-option input[type="radio"]:checked + .custom-radio {
            border-color: #3498db;
        }

        .radio-option input[type="radio"]:checked + .custom-radio::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 10px;
            height: 10px;
            background-color: #3498db;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            display: block;
        }

        .radio-option .option-text {
            font-weight: normal;
            color: #333;
            flex-grow: 1;
        }

        .radio-option input[type="radio"]:checked ~ .option-text {
            color: #3498db;
        }

        /* Estilos para checkbox con 3 columnas */
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
        }

        .checkbox-option {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-option:hover {
            border-color: #3498db;
        }

        .checkbox-option input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .checkbox-option .custom-checkbox {
            position: relative;
            display: inline-block;
            width: 20px;
            height: 20px;
            min-width: 20px;
            margin-right: 12px;
            border: 2px solid #3498db;
            border-radius: 4px;
            background-color: white;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        .checkbox-option input[type="checkbox"]:checked + .custom-checkbox {
            background-color: #3498db;
            border-color: #3498db;
        }

        .checkbox-option input[type="checkbox"]:checked + .custom-checkbox::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 12px;
            height: 12px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z'/%3E%3C/svg%3E");
            background-position: center;
            background-repeat: no-repeat;
            background-size: contain;
            transform: translate(-50%, -50%);
            display: block;
        }

        .checkbox-option .option-text {
            font-weight: normal;
            color: #333;
            flex-grow: 1;
        }

        .checkbox-option input[type="checkbox"]:checked ~ .option-text {
            color: #3498db;
        }

        .required:after {
            content: " *";
            color: red;
        }
        .submit-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            width: auto;
            max-width: 100%;
        }
        .repeat-section {
            border: 1px dashed #3498db;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #eaf2f8;
            overflow: hidden;
        }
        .hidden {
            display: none;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 0.9em;
            color: #666;
        }
        .thank-you {
            text-align: center;
            padding: 30px;
            display: none;
        }
        .thank-you img {
            max-width: 100px;
            margin-bottom: 20px;
        }

        /* Estilo para el contenedor de búsqueda */
        .map-search-container {
            position: absolute;
            top: 10px;
            left: 50px;
            right: 50px;
            z-index: 1000;
        }
        .map-search-input {
            width: 100%;
            padding: 12px 15px;
            font-size: 16px;
            border: 1px solid #d3d3d3;
            border-radius: 24px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            outline: none;
        }
        .map-search-input:focus {
            border-color: #4d90fe;
        }
        
        /* Estilo mejorado para las sugerencias */
        .search-suggestions {
            background: white;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            margin-top: -12px;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }
        .search-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
        }
        .search-suggestion:hover {
            background-color: #f5f5f5;
        }
        .search-suggestion:last-child {
            border-bottom: none;
        }
        .search-suggestion.active {
            background-color: #e6f2ff;
        }
        .search-suggestion .main-text {
            font-weight: bold;
            display: block;
        }
        .search-suggestion .secondary-text {
            color: #666;
            font-size: 0.9em;
            display: block;
        }

        /* Estilo para las sugerencias de búsqueda */
        .geocoder-control-suggestions {
            background: white;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            margin-top: -1px;
        }

        .geocoder-control-suggestions.hidden {
            display: none;
        }

        .geocoder-control-suggestion {
            padding: 10px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 14px;
            transition: background-color 0.2s;
        }

        .geocoder-control-suggestion:last-child {
            border-bottom: none;
        }

        .geocoder-control-suggestion:hover {
            background-color: #f5f5f5;
        }

        /* Estilo del contenedor de coordenadas */
        .coordinates-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            font-size: 14px;
        }

        .coordinates-container .coord-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .coordinates-container label {
            color: #555;
            font-weight: bold;
            margin: 0;
            white-space: nowrap;
        }

        .coordinates-container input {
            width: 120px;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 13px;
            background: white;
        }

        /* Créditos del mapa */
        .map-credit {
            position: absolute;
            bottom: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.8);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 11px;
            color: #555;
        }

        /* Estilo para el contenedor del mapa */
        .map-container {
            height: 400px;  /* Aumentamos la altura */
            width: 100%;    /* Mantenemos el ancho al 100% */
            margin-top: 10px;
            background-color: #eee;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            aspect-ratio: 1 / 1; /* Esto fuerza una relación 1:1 (cuadrado perfecto) */
        }
        
        /* Nuevos estilos para campos de "Otro" */
        .other-input-container {
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        /* Estilos para preguntas condicionales */
        .conditional-question {
            margin-top: 15px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #3498db;
        }

        /* Estilos para el contenedor del mapa */
        .map-container {
            height: 400px;
            width: 100%;
            margin-top: 10px;
            background-color: #f8f9fa;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            border: 1px solid #ddd;
            min-height: 400px; /* Asegura una altura mínima */
        }
        
        /* Asegurar que Leaflet tenga los estilos correctos */
        .leaflet-container {
            height: 100%;
            width: 100%;
            z-index: 1;
        }
        
        /* Contenedor de coordenadas */
        .coordinates-container {
            position: absolute;
            bottom: 10px;
            left: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px;
            border-radius: 6px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            font-size: 14px;
            backdrop-filter: blur(5px);
        }
        
        .coordinates-container .coord-group {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 150px;
        }
        
        .coordinates-container label {
            color: #2c3e50;
            font-weight: bold;
            margin: 0;
            white-space: nowrap;
            min-width: 40px;
        }
        
        .coordinates-container input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            background: white;
            min-width: 100px;
        }
        
        .coordinates-container input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        /* Asegurar que los controles del mapa sean visibles */
        .leaflet-control-geocoder {
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            border-radius: 4px;
        }
        
        .leaflet-control-geocoder-form {
            margin: 0;
        }
        
        .leaflet-control-geocoder-form input {
            padding: 8px 12px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Banner superior -->
    <div class="banner">
        <img src="https://raw.githubusercontent.com/mariana-navarro/imagenes/refs/heads/main/hub%20los%20rios/SIGER%20(2).png" alt="Logo Municipalidad">
    </div>

    <div class="container">
        <div id="form-container">
            <div class="form-header-banner">
                Levantamiento de Recursos y Capacidades Comunales
            </div>

            <form id="main-form">
                <!-- Sección de Información Básica -->
                <div class="form-section">
                    <h2>Información Básica</h2>
                    
                    <div class="form-group hidden">
                        <label for="region">Región</label>
                        <input type="text" id="region" name="region" class="form-control" value="Región Metropolitana" readonly>
                    </div>
                    
                    <div class="form-group">
                        <label for="fecha_hora" class="required">Fecha y Hora</label>
                        <div class="datetime-container">
                            <input type="datetime-local" id="fecha_hora" name="fecha_hora" class="form-control" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="rut" class="required">RUT</label>
                        <input type="text" id="rut" name="rut" class="form-control" required pattern="^[0-9]{7,8}-[0-9K]$">
                        <p class="hint">Ingrese su RUT sin puntos y con guion. En caso de que su RUT termine en K, ésta debe ser mayúscula. Ej: 12345678-K</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="doc" class="required">Código de Usuario Único</label>
                        <input type="text" id="doc" name="doc" class="form-control" required>
                        <p class="hint">Ingrese su Código de Usuario Único. Ej: XXX11111</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="comuna" class="required">Comuna</label>
                        <select id="comuna" name="comuna" class="form-control" required>
                            <option value="">Seleccione una comuna</option>
                            <!-- Opciones de comunas se llenarán dinámicamente -->
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="nombre" class="required">Nombre</label>
                        <input type="text" id="nombre" name="nombre" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="cargo" class="required">Cargo</label>
                        <input type="text" id="cargo" name="cargo" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="telefono" class="required">Teléfono de Contacto</label>
                        <input type="tel" id="telefono" name="telefono" class="form-control" required>
                        <p class="hint">Ingrese su Número Telefónico. Ej: +569XXXXXXXX</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="required">Correo Electrónico</label>
                        <input type="email" id="email" name="email" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="tipo_recurso" class="required">Tipo de Recursos</label>
                        <select id="tipo_recurso" name="tipo_recurso" class="form-control" required>
                            <option value="">Seleccione un tipo</option>
                            <option value="Medios de Transporte">Medios de Transporte</option>
                            <option value="Recursos Humanos">Recursos Humanos</option>
                            <option value="Herramientas o Elementos Auxiliares">Herramientas o Elementos Auxiliares</option>
                        </select>
                        <p class="hint">Indique el tipo de recurso que ingresará.</p>
                    </div>
                </div>
                
                <!-- Sección de Medios de Transporte -->
                <div id="transporte-section" class="form-section hidden">
                    <div class="section-header">
                        <h3 class="section-title">Medios de Transporte</h3>
                        <div class="resource-controls">
                            <button type="button" class="nav-button delete-button" id="delete-transporte"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M5 0h4a1 1 0 0 1 1 1v1h3.5a.5.5 0 1 1 0 1h-1v11a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V3h-1a.5.5 0 0 1 0-1H4V1a1 1 0 0 1 1-1m0 1v1h4V1zM2.5 3v11a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V3zm7 2a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5M7 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7A.5.5 0 0 1 7 5M4.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5"></path></svg></button>
                            <div class="resource-counter" id="transporte-counter"></div>
                            <button type="button" class="nav-button add-button" id="add-transporte">+</button>
                        </div>
                    </div>
                    <p class="hint">A continuación deberá rellenar uno por uno la información de los medios de transporte de su municipio.</p>
                    
                    <div id="transporte-repeats"></div>
                </div>
                
                <!-- Sección de Recursos Humanos -->
                <div id="humanos-section" class="form-section hidden">
                    <div class="section-header">
                        <h3 class="section-title">Recursos Humanos</h3>
                        <div class="resource-controls">
                            <button type="button" class="nav-button delete-button" id="delete-humanos"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M5 0h4a1 1 0 0 1 1 1v1h3.5a.5.5 0 1 1 0 1h-1v11a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V3h-1a.5.5 0 0 1 0-1H4V1a1 1 0 0 1 1-1m0 1v1h4V1zM2.5 3v11a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V3zm7 2a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5M7 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7A.5.5 0 0 1 7 5M4.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5"></path></svg></button>
                            <div class="resource-counter" id="humanos-counter"></div>
                            <button type="button" class="nav-button add-button" id="add-humanos">+</button>
                        </div>
                    </div>
                    <p class="hint">A continuación deberá rellenar uno por uno la información de recursos humanos de su municipio.</p>
                    
                    <div id="humanos-repeats"></div>
                </div>
                
                <!-- Sección de Herramientas -->
                <div id="herramientas-section" class="form-section hidden">
                    <div class="section-header">
                        <h3 class="section-title">Herramientas o Elementos Auxiliares</h3>
                        <div class="resource-controls">
                            <button type="button" class="nav-button delete-button" id="delete-herramientas"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M5 0h4a1 1 0 0 1 1 1v1h3.5a.5.5 0 1 1 0 1h-1v11a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V3h-1a.5.5 0 0 1 0-1H4V1a1 1 0 0 1 1-1m0 1v1h4V1zM2.5 3v11a1 1 0 0 0 1 1h7a1 1 0 0 0 1-1V3zm7 2a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5M7 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7A.5.5 0 0 1 7 5M4.5 5a.5.5 0 0 1 .5.5v7a.5.5 0 1 1-1 0v-7a.5.5 0 0 1 .5-.5"></path></svg></button>
                            <div class="resource-counter" id="herramientas-counter"></div>
                            <button type="button" class="nav-button add-button" id="add-herramientas">+</button>
                        </div>
                    </div>
                    <p class="hint">A continuación deberá rellenar uno por uno la información de herramientas o elementos auxiliares de su municipio.</p>
                    
                    <div id="herramientas-repeats"></div>
                </div>
                
                <button type="submit" class="submit-btn">Enviar</button>
            </form>
        </div>
        
        <div id="thank-you" class="thank-you">
            <img src="thankYouScreen.svg" alt="Icono de marca de verificación verde">
            <h2>Gracias.</h2>
            <p>Su respuesta se ha enviado correctamente.</p>
        </div>
    </div>

    <!-- Agregar Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <!-- Agregar Nominatim para geocodificación -->
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

   <script>
document.addEventListener('DOMContentLoaded', function() {
    // Configurar fecha y hora actual
    const now = new Date();
    const fechaHoraInput = document.getElementById('fecha_hora');
    const offset = now.getTimezoneOffset();
    now.setMinutes(now.getMinutes() - offset);
    fechaHoraInput.value = now.toISOString().slice(0, 16);
    
    // Mostrar/ocultar secciones según tipo de recurso seleccionado
    const tipoRecursoSelect = document.getElementById('tipo_recurso');
    tipoRecursoSelect.addEventListener('change', function() {
        document.getElementById('transporte-section').classList.add('hidden');
        document.getElementById('humanos-section').classList.add('hidden');
        document.getElementById('herramientas-section').classList.add('hidden');
        
        if (this.value === 'Medios de Transporte') {
            document.getElementById('transporte-section').classList.remove('hidden');
        } else if (this.value === 'Recursos Humanos') {
            document.getElementById('humanos-section').classList.remove('hidden');
        } else if (this.value === 'Herramientas o Elementos Auxiliares') {
            document.getElementById('herramientas-section').classList.remove('hidden');
        }
    });
    
    // Llenar opciones de comunas (ejemplo)
    const comunaSelect = document.getElementById('comuna');
    const comunas = [
        'Cerrillos', 'Cerro Navia', 'Conchalí', 'El Bosque', 'Estación Central', 
        'Huechuraba', 'Independencia', 'La Cisterna', 'La Florida', 'La Granja',
        'La Pintana', 'La Reina', 'Las Condes', 'Lo Barnechea', 'Lo Espejo',
        'Lo Prado', 'Macul', 'Maipú', 'Ñuñoa', 'Pedro Aguirre Cerda',
        'Peñalolén', 'Providencia', 'Pudahuel', 'Quilicura', 'Quinta Normal',
        'Recoleta', 'Renca', 'San Joaquín', 'San Miguel', 'San Ramón',
        'Santiago', 'Vitacura'
    ];
    
    comunas.forEach(comuna => {
        const option = document.createElement('option');
        option.value = comuna;
        option.textContent = comuna;
        comunaSelect.appendChild(option);
    });
    
    // Variables para manejar recursos
    const resources = {
        transporte: {
            count: 0,
            current: 0,
            container: document.getElementById('transporte-repeats'),
            counter: document.getElementById('transporte-counter'),
            maps: {}
        },
        humanos: {
            count: 0,
            current: 0,
            container: document.getElementById('humanos-repeats'),
            counter: document.getElementById('humanos-counter'),
            maps: {}
        },
        herramientas: {
            count: 0,
            current: 0,
            container: document.getElementById('herramientas-repeats'),
            counter: document.getElementById('herramientas-counter'),
            maps: {}
        }
    };
    
    // Configurar botones de agregar
    document.getElementById('add-transporte').addEventListener('click', function() {
        addResource('transporte');
    });
    
    document.getElementById('add-humanos').addEventListener('click', function() {
        addResource('humanos');
    });
    
    document.getElementById('add-herramientas').addEventListener('click', function() {
        addResource('herramientas');
    });
    
    // Configurar botones de eliminar
    document.getElementById('delete-transporte').addEventListener('click', function() {
        deleteResource('transporte');
    });
    
    document.getElementById('delete-humanos').addEventListener('click', function() {
        deleteResource('humanos');
    });
    
    document.getElementById('delete-herramientas').addEventListener('click', function() {
        deleteResource('herramientas');
    });

    // Función para inicializar un mapa
    function initMap(containerId, resourceType, resourceId) {
        const mapDiv = document.getElementById(containerId);
        if (!mapDiv) {
            console.error('No se encontró el contenedor del mapa:', containerId);
            return null;
        }
        
        mapDiv.innerHTML = '';
        
        // Coordenadas iniciales (Santiago de Chile)
        const initialLat = -33.4489;
        const initialLng = -70.6693;
        
        // Crear el mapa
        const map = L.map(containerId).setView([initialLat, initialLng], 13);
        
        // Añadir capa de OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
            maxZoom: 19
        }).addTo(map);
        
        // Añadir marcador
        let marker = L.marker([initialLat, initialLng], {
            draggable: true
        }).addTo(map);
        
        // Crear contenedor de coordenadas
        const coordsContainer = L.DomUtil.create('div', 'coordinates-container');
        map.getContainer().appendChild(coordsContainer);
        
        // Grupo Latitud
        const latGroup = L.DomUtil.create('div', 'coord-group');
        const latLabel = L.DomUtil.create('label', '', latGroup);
        latLabel.textContent = 'Lat:';
        const latInput = L.DomUtil.create('input', 'coord-input', latGroup);
        latInput.type = 'text';
        latInput.value = initialLat.toFixed(6);
        latInput.setAttribute('data-coord', 'lat');
        latInput.setAttribute('name', `coordenadas_${resourceType}_${resourceId}_lat`);
        
        // Grupo Longitud
        const lngGroup = L.DomUtil.create('div', 'coord-group');
        const lngLabel = L.DomUtil.create('label', '', lngGroup);
        lngLabel.textContent = 'Lon:';
        const lngInput = L.DomUtil.create('input', 'coord-input', lngGroup);
        lngInput.type = 'text';
        lngInput.value = initialLng.toFixed(6);
        lngInput.setAttribute('data-coord', 'lng');
        lngInput.setAttribute('name', `coordenadas_${resourceType}_${resourceId}_lng`);
        
        // Agregar grupos al contenedor
        coordsContainer.appendChild(latGroup);
        coordsContainer.appendChild(lngGroup);
        
        // Añadir control de búsqueda
        L.Control.geocoder({
            defaultMarkGeocode: false,
            position: 'topleft',
            placeholder: 'Buscar dirección...',
            errorMessage: 'No se encontraron resultados.',
            geocoder: L.Control.Geocoder.nominatim({
                geocodingQueryParams: {
                    countrycodes: 'cl',
                    'accept-language': 'es'
                }
            })
        })
        .on('markgeocode', function(e) {
            const { center, name } = e.geocode;
            
            marker.setLatLng(center);
            map.setView(center, 16);
            
            latInput.value = center.lat.toFixed(6);
            lngInput.value = center.lng.toFixed(6);
            
            const ubicacionInput = document.querySelector(`input[name^="ubicacion_${resourceType}_${resourceId}"]`);
            if (ubicacionInput) {
                ubicacionInput.value = name;
            }
        })
        .addTo(map);

        // Función para actualizar coordenadas
        function updateCoordinates(lat, lng) {
            latInput.value = lat.toFixed(6);
            lngInput.value = lng.toFixed(6);
        }
        
        // Actualizar coordenadas cuando se mueve el marcador
        marker.on('dragend', function(e) {
            const { lat, lng } = e.target.getLatLng();
            updateCoordinates(lat, lng);
        });
        
        // Manejar clics en el mapa
        map.on('click', function(e) {
            const { lat, lng } = e.latlng;
            marker.setLatLng([lat, lng]);
            updateCoordinates(lat, lng);
        });
        
        // Forzar el redimensionamiento del mapa
        setTimeout(() => {
            map.invalidateSize();
        }, 300);
        
        // Guardar referencia al mapa
        if (!resources[resourceType].maps) {
            resources[resourceType].maps = {};
        }
        resources[resourceType].maps[resourceId] = {
            map: map,
            marker: marker,
            latInput: latInput,
            lngInput: lngInput
        };
        
        return {
            map: map,
            marker: marker,
            latInput: latInput,
            lngInput: lngInput
        };
    }
    
    // Función para agregar un nuevo recurso - VERSIÓN CORREGIDA
    function addResource(type) {
        const resource = resources[type];
        resource.count++;
        resource.current = resource.count;

        updateCounter(type);
        
        const repeatDiv = document.createElement('div');
        repeatDiv.className = 'repeat-section';
        repeatDiv.id = `${type}-${resource.count}`;
        
        let content = '';
        
        if (type === 'transporte') {
            content = `
                <!-- CONTENIDO DE TRANSPORTE (igual al que tienes) -->
            `;
        } else if (type === 'humanos') {
            content = `
                <!-- CONTENIDO DE HUMANOS (igual al que tienes) -->
            `;
        } else if (type === 'herramientas') {
            content = `
                <!-- CONTENIDO DE HERRAMIENTAS (igual al que tienes) -->
            `;
        }
        
        repeatDiv.innerHTML = content;
        resource.container.appendChild(repeatDiv);

        // Ocultar todas las secciones excepto la actual
        const allSections = resource.container.querySelectorAll('.repeat-section');
        allSections.forEach(section => {
            section.style.display = 'none';
        });
        
        showResource(type, resource.current);
        setupOtherFields(repeatDiv);
        
        // Configurar eventos para mostrar/ocultar preguntas condicionales
        setupConditionalQuestions(repeatDiv, type, resource.count);
        
        // Inicializar el mapa después de un breve retraso
        setTimeout(() => {
            let mapContainerId;
            if (type === 'transporte') {
                mapContainerId = `map-container-transporte-${resource.count}`;
            } else if (type === 'humanos') {
                mapContainerId = `map-container-humano-${resource.count}`;
            } else if (type === 'herramientas') {
                mapContainerId = `map-container-herramienta-${resource.count}`;
            }
            
            initMap(mapContainerId, type, resource.count);
        }, 100);
    }
    
    // Función para mostrar el recurso específico
    function showResource(type, index) {
        const resource = resources[type];
        const elements = resource.container.querySelectorAll('.repeat-section');
        
        elements.forEach(el => {
            el.style.display = 'none';
        });
        
        const elementToShow = document.getElementById(`${type}-${index}`);
        if (elementToShow) {
            elementToShow.style.display = 'block';
            
            // Redimensionar el mapa cuando se muestra la sección
            setTimeout(() => {
                if (resource.maps && resource.maps[index] && resource.maps[index].map) {
                    resource.maps[index].map.invalidateSize();
                }
            }, 100);
        }
    }
    
    // Función para actualizar el contador
    function updateCounter(type) {
        const resource = resources[type];
        resource.counter.innerHTML = '';
        
        for (let i = 1; i <= resource.count; i++) {
            const number = document.createElement('div');
            number.className = `resource-number ${i === resource.current ? 'active' : ''}`;
            number.textContent = i;
            number.addEventListener('click', () => {
                resource.current = i;
                updateCounter(type);
                showResource(type, i);
            });
            resource.counter.appendChild(number);
        }
    }
    
    // Función para eliminar recurso
    function deleteResource(type) {
        const resource = resources[type];
        if (resource.count === 0) return;

        const positionToDelete = resource.current;
        const elementToDelete = document.getElementById(`${type}-${positionToDelete}`);
        if (elementToDelete) elementToDelete.remove();

        for (let i = positionToDelete + 1; i <= resource.count; i++) {
            const currentElement = document.getElementById(`${type}-${i}`);
            if (!currentElement) continue;

            const newIndex = i - 1;
            currentElement.id = `${type}-${newIndex}`;

            const allFields = currentElement.querySelectorAll('[name]');
            allFields.forEach(field => {
                field.name = field.name.replace(`_${i}_`, `_${newIndex}_`);
            });
        }

        resource.count--;
        resource.current = Math.min(positionToDelete, resource.count);
        updateCounter(type);
        
        if (resource.count > 0) {
            showResource(type, resource.current);
        } else {
            resource.current = 0;
        }
    }
    
    // Función para configurar preguntas condicionales
    function setupConditionalQuestions(container, type, resourceId) {
        if (type === 'transporte') {
            const tipoTransporteRadios = container.querySelectorAll('input[name^="tipo_transporte_"]');
            tipoTransporteRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    container.querySelectorAll('.conditional-question').forEach(q => {
                        q.classList.add('hidden');
                    });
                    
                    if (this.value === 'transporte_personal') {
                        container.querySelector(`#tipo_vehiculo_personal_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'transporte_carga') {
                        container.querySelector(`#vehiculo_carga_materiales_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'maquinaria') {
                        container.querySelector(`#maquinaria_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'ambulancia') {
                        container.querySelector(`#ambulancia_${resourceId}`).classList.remove('hidden');
                    }
                });
            });
            
            const fuenteFinanciamientoSelect = container.querySelector('select[name^="fuente_financiamiento_"]');
            if (fuenteFinanciamientoSelect) {
                fuenteFinanciamientoSelect.addEventListener('change', function() {
                    const recursosExternosDiv = container.querySelector(`#recursos_externos_${resourceId}`);
                    if (this.value === 'Recursos Externos') {
                        recursosExternosDiv.classList.remove('hidden');
                    } else {
                        recursosExternosDiv.classList.add('hidden');
                    }
                });
            }
        } else if (type === 'herramientas') {
            const tipoHerramientaRadios = container.querySelectorAll('input[name^="tipo_herramienta_"]');
            tipoHerramientaRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    container.querySelectorAll('.conditional-question').forEach(q => {
                        q.classList.add('hidden');
                    });
                    
                    if (this.value === 'Equipamiento de Protección Personal') {
                        container.querySelector(`#equipamiento_proteccion_personal_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'Kit de Higiene Personal') {
                        container.querySelector(`#kit_higiene_personal_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'Kit de Alimentación y Suplementos') {
                        container.querySelector(`#kit_alimentacion_suplementos_${resourceId}`).classList.remove('hidden');
                    } else if (this.value === 'Contenedor de Agua') {
                        container.querySelector(`#contenedor_agua_${resourceId}`).classList.remove('hidden');
                    }
                });
            });
        }
    }
    
    // Función para manejar campos "Otro"
    function setupOtherFields(container) {
        const radioGroups = container.querySelectorAll('.radio-group');
        radioGroups.forEach(group => {
            const radios = group.querySelectorAll('input[type="radio"]');
            radios.forEach(radio => {
                if (radio.checked && (radio.value === 'otro' || radio.value === 'other')) {
                    showOtherInput(radio);
                }
                
                radio.addEventListener('change', function() {
                    if (this.value === 'otro' || this.value === 'other') {
                        showOtherInput(this);
                    } else {
                        hideOtherInput(this);
                    }
                });
            });
        });
        
        const checkboxGroups = container.querySelectorAll('.checkbox-group');
        checkboxGroups.forEach(group => {
            const otherCheckbox = group.querySelector('input[type="checkbox"][value="other"]');
            const otherInputContainer = group.closest('.form-group').querySelector('.other-input-container');
            
            if (otherCheckbox && otherCheckbox.checked) {
                otherInputContainer.classList.remove('hidden');
            }
            
            if (otherCheckbox) {
                otherCheckbox.addEventListener('change', function() {
                    if (this.checked) {
                        otherInputContainer.classList.remove('hidden');
                    } else {
                        otherInputContainer.classList.add('hidden');
                        const inputField = otherInputContainer.querySelector('input');
                        if (inputField) {
                            inputField.value = '';
                        }
                    }
                });
            }
        });
    }
    
    function showOtherInput(inputElement) {
        const container = inputElement.closest('.form-group');
        if (!container) return;
        
        const otherInputContainer = container.querySelector('.other-input-container');
        if (otherInputContainer) {
            otherInputContainer.classList.remove('hidden');
        }
    }
    
    function hideOtherInput(inputElement) {
        const container = inputElement.closest('.form-group');
        if (!container) return;
        
        const otherInputContainer = container.querySelector('.other-input-container');
        if (otherInputContainer) {
            otherInputContainer.classList.add('hidden');
            const inputField = otherInputContainer.querySelector('input');
            if (inputField) {
                inputField.value = '';
            }
        }
    }
    
    // Función para recolectar coordenadas
    function collectCoordinates() {
        const coordinates = {};
        
        for (const [type, resource] of Object.entries(resources)) {
            if (resource.maps) {
                for (let i = 1; i <= resource.count; i++) {
                    if (resource.maps[i]) {
                        coordinates[`coordenadas_${type}_${i}_lat`] = resource.maps[i].latInput.value;
                        coordinates[`coordenadas_${type}_${i}_lng`] = resource.maps[i].lngInput.value;
                    }
                }
            }
        }
        
        return coordinates;
    }
    
    // Event listener para enviar formulario
    document.getElementById('main-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (this.checkValidity()) {
            const formData = new FormData(this);
            const data = Object.fromEntries(formData.entries());
            
            data.transporte_count = resources.transporte.count;
            data.humanos_count = resources.humanos.count;
            data.herramientas_count = resources.herramientas.count;
            
            const coordenadas = collectCoordinates();
            Object.assign(data, coordenadas);
            
            const webAppUrl = 'https://script.google.com/macros/s/AKfycbxs-N9vYOzfi3KZjS2cL0rWjPqoNVHw8cCG-0FSKENhAIA_5NxMhzS6jCwXuRt2G-t2Ug/exec';
            
            console.log('Datos a enviar:', data);
            
            fetch(webAppUrl, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            })
            .then(() => {
                document.getElementById('form-container').style.display = 'none';
                document.getElementById('thank-you').style.display = 'block';
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Hubo un error al enviar el formulario. Por favor, inténtelo nuevamente.');
            });
        } else {
            alert('Por favor complete todos los campos requeridos.');
        }
    });
});
</script>
</body>
</html>




